<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Allan&#39;s blog &middot; Allan&#39;s blog </title>

  
  <link rel="stylesheet" href="http://allan-simon.github.io/blog/css/poole.css">
  <link rel="stylesheet" href="http://allan-simon.github.io/blog/css/syntax.css">
  <link rel="stylesheet" href="http://allan-simon.github.io/blog/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="http://allan-simon.github.io/blog/index.xml/" rel="alternate" type="application/rss+xml" title="Allan&#39;s blog" />
</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Allan&#39;s blog</h1>
      <p class="lead">
       Tips, tricks and random thoughts on Linux/Vim/rust/php/devops 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/blog/">Home</a> </li>
      
    </ul>

    <p>Â© Creative-Common attribution</p>
  </div>
</div>


    <div class="content container">
<div class="posts">

      
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/symfony-2.6-tips-1/">
        symfony 2.6 tips #1
      </a>
    </h1>

    <span class="post-date">Wed, Mar 11, 2015</span>

    

<p>Here a list of tips for symfony 2.6 I&rsquo;ve gathered these days</p>

<p>###Skip test in phpunit</p>

<p>Imagine you&rsquo;re rewriting your application to split &lsquo;big&rsquo; pages into
set of smaller actions. You got your test already written but they
are going to fail the time you finish the rewrite, and because you&rsquo;re
in company with tight deadline, you don&rsquo;t have time to adapt the tests
&ldquo;right here right now&rdquo; several possibilities</p>

<ul>
<li>Leave the tests failing until you fix them <code>master</code>.</li>
<li>Delete the test.</li>
<li>Put between comments the failing tests.</li>
</ul>

<p>All these solutions are suboptimals, instead you can add this line at the beginning of your test method</p>

<pre><code>public function testMyTestWhichYouWantToSkip()
{
    $this-&gt;markTestSkipped(&quot;message explaining why it's skipped&quot;);
    // your test code, unmodified
}
</code></pre>

<p>so that it will appear with a <code>S</code> in the test report, so that you have a reminder that there&rsquo;s something to fix.</p>

<h3 id="toc_0">Disable form validation in test</h3>

<p>You&rsquo;re writing functionnal test and you need to check the case of an form submitted with bogus data (to be sure your server side code is protected against hand-crafted request). By default the form you get in functionnal test will have the same checking rules than the one on server side, so in order to disable checking you can do</p>

<pre><code>$form['country']-&gt;disableValidation()-&gt;select('Invalid value');
</code></pre>

<h3 id="toc_1">(Doctrine) don&rsquo;t use findById() when you just mean find()</h3>

<p>well, the title is self-explaining</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/redmine-cli/">
        Redmine-cli and redmine API
      </a>
    </h1>

    <span class="post-date">Wed, Feb 25, 2015</span>

    

<p>I found a tool to manage redmine from the cli, in python:</p>

<p><code>pip install redmine-cli</code></p>

<p>then a config file <code>~/.redmine-cli</code></p>

<pre><code>[default]
key=API_KEY_YOU_CAN_SEE_IN_YOUR_ACCOUNT_ON_REDMINE
my_id=ID_YOU_CAN_ON_YOUR_PROFILE_PAGE
root_url=HOME_PAGE_OF_REDMINE
</code></pre>

<p>then you can do</p>

<ol>
<li><code>redmine open 123</code> to open the issue 123 in your browser</li>
<li><code>redmine issues</code> to see your issues</li>
<li><code>redmine issue 123</code> to see information about issue 123</li>
</ol>

<p>(it has more options I let you check the doc)</p>

<ul>
<li><a href="https://github.com/yanjost/redmine-cli">original repo</a></li>
<li><a href="https://github.com/allan-simon/redmine-cli">my fork where I have some features (like updating a ticket</a></li>
</ul>

<p>(hopefully my modification are in PR on the original repo and will be soon integrated)
my modification include so far:</p>

<ul>
<li><code>redmine issue 123 long</code> to see more detailled information about the issue</li>
<li><code>redmine update 123 'in progress'</code> to update the status to <code>in progress</code> (admitting your redmine has this status)</li>
</ul>

<h3 id="toc_0">The long story behind:</h3>

<p>As any good Linux user, I love the CLI (no, there&rsquo;s no such thing
as a <strong>good</strong> Linux user who does not love the CLI). Starting from
that, though I appreciate using Redmine to manage features to implement,
bugs etc. I&rsquo;m not really fan of needing to click here and there,
especially when the only things I want is</p>

<ul>
<li>know what a Merge request on gitlab referencing the ticket XXX is about</li>
<li>see what tickets are assigned to me</li>
<li>update a ticket status</li>
</ul>

<p>It becomes even less practical when you want to update a list of ticket
you can either:</p>

<ol>
<li>select in the list, while keeping shift pressed, the list of ticket you want to update</li>
<li>right click,</li>
<li>update the status</li>
</ol>

<p>The problem of that technique is that, if you click a little too much on the right,
on the left etc. you loose your selection, which can be very frustating
Then you have the second technique</p>

<ol>
<li>click on ticket N</li>
<li>click on update</li>
<li>update, click on submit</li>
</ol>

<p>each of these steps impliying a page load, no need to tell you how much times
it takes even for 5 tickets</p>

<h3 id="toc_1">The CLI will always be there for you: redmine-cli</h3>

<p>For now some month, whenever I&rsquo;m looking for that little tool, the reflex is to
search for it on github. As I knew there was a Redmine API and that we don&rsquo;t have
time for a NIH (Not Invented Here) syndrom, it was very likely such a CLI tool
would already exist.</p>

<p>I found a several tool, <a href="https://github.com/diasjorge/redmine-cli">one in ruby</a>
which seems rather complete, but as it was not updated for 2 years, and I didn&rsquo;t felt
like installing ruby on my computer (I guess it&rsquo;s already install but&hellip;) and it was
late, so losing 2 minutes to know how to install the project was too much</p>

<ul>
<li>ALWAYS PUT CLEAR INSTRUCTION , DUMB PROOF, ON HOW TO INSTALL YOUR TOOL</li>
<li>if a project is &ldquo;complete&rdquo; and its the reason why you&rsquo;re not updating it, state it
so that people know if the project is dead or just &lsquo;in good shape enough but the author is still active&rsquo;</li>
</ul>

<p>So I found the python project, which was updated in 2014 and
had clear installation instruction <code>pip install redmine-cli</code></p>

<h3 id="toc_2">Missing feature: redmine API my love</h3>

<p>while implementing the feature I found that</p>

<ul>
<li>the API call was returning a 200 (without nothing in the body)</li>
<li>BUT the status was not updated (though the ticket was showing activity &lsquo;less than a minute ago&rsquo;)</li>
</ul>

<p>after some research I found <a href="http://www.redmine.org/boards/2/topics/25920">that redmine discussion</a></p>

<ul>
<li>I need to declare the header <code>Application/Json</code> (normal)</li>
<li>It needs to have the <code>status_id</code> value as a string (and I was giving an integer)</li>
</ul>

<p>The second point is raging because GUESS WHAT, that integer was given to me BY REDMINE ITSELF !
So please please when you do an API</p>

<ul>
<li>Be consistent, if <code>status_id</code> is an integer once, it must always be a integer</li>
<li>Have a clear documentation, with example</li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/form-name-goes-into-global-scope-javascript/">
        Form name goes into global scope in javascript
      </a>
    </h1>

    <span class="post-date">Mon, Feb 23, 2015</span>

    

<p>An interesting problem a friend of mine discovered today</p>

<p>Can you spot the problem?</p>

<h3 id="toc_0">Le javascript</h3>

<pre><code>var CreateVersion = (function(){
    'use strict';

    var foo = function(text) {
        console.log(text);
    };

    return {
        foo : foo 
    };
}());
</code></pre>

<h3 id="toc_1">Le HTML</h3>

<pre><code>&lt;form name=&quot;CreateVersion&quot; method=&quot;post&quot; action=&quot;&quot;&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label&gt;
            &lt;span&gt;something&lt;/span&gt;
            &lt;!--
                onClick on a span is a bad pratice and will be
                the object of an other post
            --&gt;
            &lt;span onclick=&quot;CreateVersion.foo('plop')&quot;&gt;plop/span&gt;
            &lt;span onclick=&quot;CreateVersion.foo('prout')&quot;&gt;prout&lt;/span&gt;
        &lt;/label&gt;
        &lt;input
            id=&quot;CreateVersion_name&quot;
            name=&quot;CreateVersion[name]&quot;
            class=&quot;form-control version_name&quot;
            type=&quot;text&quot;
        /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
        &lt;label&gt;
            &lt;span&gt;something something&lt;/span&gt;:
            &lt;span class=&quot;text_length&quot;&gt;0&lt;/span&gt;
        &lt;/label&gt;
        &lt;input
            id=&quot;CreateVersion_articleNotes&quot;
            name=&quot;CreateVersion[articleNotes]&quot;
            class=&quot;form-control&quot;
            type=&quot;text&quot;
        /&gt;
    &lt;/div&gt;
    &lt;hr/&gt;
    &lt;div&gt;
        &lt;button
            type=&quot;submit&quot;
            id=&quot;CreateVersion_submit&quot;
            name=&quot;CreateVersion[submit]&quot;
        &gt;
            submit
        &lt;/button&gt;
    &lt;/div&gt;
&lt;/form&gt;
</code></pre>

<h3 id="toc_2">Le erreur</h3>

<pre><code>TypeError: CreateVersion.foo is not a function
</code></pre>

<p>No, not in IE6, in last version of Firefox/Chrome</p>

<h3 id="toc_3">Le solution</h3>

<p>This line</p>

<pre><code>    &lt;form name=&quot;CreateVersion&quot; method=&quot;post&quot; action=&quot;&quot;&gt;
</code></pre>

<p>declare a Form with a name <code>CreateVersion</code> which is exactly the same name as our
Javascript module, and guess what ?</p>

<p>The name is exported in the DOM, which that when you do that</p>

<pre><code>&lt;form name=&quot;Foo&quot;&gt;
</code></pre>

<p>Then you can do</p>

<pre><code>document.Foo
</code></pre>

<p>to access to the DOM node, and in the HTML itself, the &ldquo;document&rdquo; is implicit which
mean that &ldquo;document.Foo&rdquo; collide with any javascript defined variable &ldquo;Foo&rdquo;</p>

<p>For more explanation see <a href="http://stackoverflow.com/questions/1415747/javascript-function-and-form-name-conflict">this stackoverflow question</a></p>

<h3 id="toc_4">How to avoid that:</h3>

<p>Some possibilities:</p>

<ul>
<li>Make it a coding style policy that module name start contains something &ldquo;javascript only&rdquo; like <code>FooModule</code> or <code>FooJS</code></li>
<li>put your modules in one big wrapping modules (like <code>MyCorp.Foo</code>)</li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/workflow-publishing-blog-post-with-hugo/">
        Workflow publishing blog post with hugo
      </a>
    </h1>

    <span class="post-date">Fri, Feb 20, 2015</span>

    <p>I&rsquo;ve added some functions in my shell to make it even more convenient
to write/edit/publish articles with <code>hugo</code> (just a self reminder)</p>

<p>so that now I have</p>

<ul>
<li>new_blog_post name-of-your-blog-post</li>
<li>publish_blog</li>
<li>edit_last_blog_post</li>
</ul>

<p>that can be run from anywhere in my terminal</p>

<pre><code>export BLOG_ROOT=~/git/perso/blog
export BLOG_THEME=hyde
export GITHUB=git@github.com:allan-simon/blog.git

function new_blog_post {
    cd $BLOG_ROOT
    LAST_BLOG_POST=$(hugo new posts/$1.md | cut -d &quot; &quot; -f 1) ;
    export LAST_BLOG_POST ;
    $EDITOR $LAST_BLOG_POST
    cd -
}

function publish_blog {
    cd $BLOG_ROOT;
    hugo --theme=&quot;$BLOG_THEME&quot; --buildDrafts &amp;&amp; \
    git add -A &amp;&amp;  \
    git commit -m &quot;Updating site&quot; &amp;&amp; \
    git push origin master &amp;&amp; \
    git subtree push --prefix=public $GITHUB gh-pages --squash  &amp;&amp; \
    echo &quot;published&quot;
    cd $BLOG_ROOT
}

function edit_last_blog_post {
    $EDITOR $LAST_BLOG_POST
}
</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/functionnal-tests-symfony2-and-authentication/">
        Functionnal tests in symfony2 with authentication
      </a>
    </h1>

    <span class="post-date">Fri, Feb 20, 2015</span>

    <p>Let&rsquo;s say you have your symfony2 website, all setup correctly with its
set of functionnal tests using phpunit, and now you start to have
pages that only authenticated users can access to. My first solution was to
create a client, make it load the login form, submit some valid credentials
and then load the actual page to test. It was working fine as the client
has a storage for cookie, it is acting like an actual browser in that case.</p>

<p>The problem was that the time to execute the test was much longer, which
started to become a problem has the test suite was growing.</p>

<p>The first trick is to follow them method adviced by symfony, which is for the
test environnement to enable the HTTP Basic Authentication method. For those
who doesn&rsquo;t know, the HTTP standard comme with a method to authentify a
user-agent by directly sending the username/password in the HTTP header
(which goes along the fact that HTTP is aimed to be stateless)</p>

<p>in your <code>config_test.yml</code> add this (replace <code>NAME_OF_YOUR_FIREWALL</code>)</p>

<pre><code>security:
    firewalls:
        NAME_OF_YOUR_FIREWALL:
            http_basic: ~
</code></pre>

<p>The second trick, to not have to repeat the username/password in all your
functionnal tests, is to use the <a href="https://github.com/liip/LiipFunctionalTestBundle">LiipFunctionnalBundle</a>
follow the installation instruction and then make your functionnal test inherit
from their class, like this</p>

<pre><code>&lt;?php
//...
use Liip\FunctionalTestBundle\Test\WebTestCase;

class YourTest extends WebTestCase
{
 // your code
}
</code></pre>

<p>then you can precise in <code>config_test.yml</code> your credentials:</p>

<pre><code>liip_functional_test:
    authentication:
        username: &quot;XXXXX&quot;
        password: &quot;YYYYY&quot;
</code></pre>

<p>finally to create an authenticated client, use this method</p>

<pre><code>&lt;?php
//...
use Liip\FunctionalTestBundle\Test\WebTestCase;

class YourTest extends WebTestCase
{
    public testYourFeature()
    {
        // true = &quot;authenticated&quot;
        $client static::makeClient(true);
        // ...
    }
}
</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/solve-composer-github-api-limitation/">
        Solve composer github api limitation
      </a>
    </h1>

    <span class="post-date">Tue, Feb 10, 2015</span>

    

<h3 id="toc_0">Could not fetch X enter your GitHub credentials to go over the API rate limit</h3>

<p>The problem is that composer is retrieving nearly all the packages from github
using the anonymous access github API. In order to solve it you need to generate
a token</p>

<ol>
<li>you need a github account (or ask a friend)</li>
<li>go on your setting page <a href="https://github.com/settings/applications">here</a></li>
<li>click on <code>Generate new token</code></li>
</ol>

<p>now two possibilities</p>

<h4 id="toc_1">1 - Put this token in one specific project</h4>

<p>for this simply run</p>

<pre><code>composer config -g github-oauth.github.com YOUR_TOKEN
</code></pre>

<p>or</p>

<pre><code>php composer.phar config -g github-oauth.github.com YOUR_TOKEN
</code></pre>

<p>(depending on how you installed composer)</p>

<p>it will add that to your project&rsquo;s composer.json file</p>

<h4 id="toc_2">2 -  Put this token in your global composer configuration</h4>

<p>If your project is an open-source or company project you may not want
to commit your token on the git of your project/company</p>

<p>for this edit the file <code>~/.composer/config.json</code> and put in it:</p>

<pre><code>{
    &quot;config&quot;: {
        &quot;github-oauth&quot;: { &quot;github.com&quot;: &quot;YOUR_TOKEN&quot; }
    }
}
</code></pre>

<p>that&rsquo;s all folks!</p>

<p>Source:</p>

<ul>
<li><a href="https://coderwall.com/p/kz4egw/composer-install-github-rate-limiting-work-around">coderwall.com</a></li>
<li><a href="https://github.com/composer/composer/issues/3542">composer&rsquo;s github</a></li>
<li><a href="https://github.com/blog/1509-personal-api-tokens">github&rsquo;s blog</a> More details about Github token</li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/install-docker-on-ubuntu-12.04/">
        Install docker on ubuntu 12.04
      </a>
    </h1>

    <span class="post-date">Tue, Feb 10, 2015</span>

    <p>This article is a shameless summary from <a href="http://compositecode.com/2013/11/11/getting-docker-installed-on-ubuntu-12-04-lts/">http://compositecode.com</a></p>

<p>the steps are:</p>

<ul>
<li>Updating your kernel to 3.8+ (requires a reboot)</li>
<li>Add the docker repository</li>
<li>Installing the package</li>
</ul>

<pre><code>sudo apt-get install linux-image-generic-lts-raring linux-headers-generic-lts-raring
sudo reboot
sudo sh -c &quot;wget -qO- https://get.docker.io/gpg | apt-key add -&quot;
sudo sh -c &quot;echo deb http://get.docker.io/ubuntu docker main &gt; /etc/apt/sources.list.d/docker.list&quot;
sudo apt-get update
sudo apt-get install lxc-docker
</code></pre>

<p>And now you should be able to get docker working</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/postgresql-display-one-column-per-line/">
        postgresql display one column per line
      </a>
    </h1>

    <span class="post-date">Tue, Feb 10, 2015</span>

    

<h3 id="toc_0">Problem : displaying a table with a lot of columns</h3>

<p>You always got that table with a dozens of columns of type text and for which
the normal tabular output does not work nicely and you end up with something
like</p>

<pre><code> articleid | plop | pouet | prout | tagada |  id   | newsid  | newstype |                                                          title                                                          | something | something | something | something | something | something | something | something |      something       |      something       | something | something | something | something |          something          |    something    |                                                                                                                                                                                                                                                                                                                 something                                                                                                                                                                                                                                                                                                                 |            something            
-----------+-------+-------+-------+-------+-------+---------+----------+-----------------------------------------------------------------------------------------------------------------------------+------------+-------------+-----------+------------+-----------------+---------+--------------+---------+---------------------+---------------------+---------------+-------------+-----------+------------+---------------------------+-----------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------+------------+--------------------------------+--------------+----------------------+------------------------------------------------------------------------------------+--------------+-----------+----------+----------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------+-----------+-------+------------
   1000163 |     0 |     0 |     0 |     0 |   141 | 1000147 |       10 | blablabla                                                                                           |          3 |           4 |        22 |    1000163 |               0 | 1000163 |          184 |   10028 | 2014-06-30 23:36:00 | 2014-06-30 23:36:00 |             0 |           0 |         0 |          0 |                           |           |          
</code></pre>

<h3 id="toc_1">In MySQL</h3>

<p>with MySQL you can replace <code>;</code> by <code>\G</code> at the end of your SQL statement, i.e turning</p>

<pre><code>SELECT * FROM example ;
</code></pre>

<p>into</p>

<pre><code>SELECT * FROM example \G
</code></pre>

<h3 id="toc_2">In PostgreSQL</h3>

<p>you need first to use <code>\x</code> and it will activate the &lsquo;one column by line&rsquo; display
(use <code>\x</code> again to switch back to normal mode)</p>

<pre><code>\x
SELECT * FROM example;
\x
</code></pre>

<p>and you will something like that</p>

<pre><code>-[ RECORD 1 ]------
articleid | 1000000
something     | 0
something     | 0
something     | 0
something     | 0
id        | 1
-[ RECORD 2 ]------
articleid | 1000002
something     | 0
something     | 0
something     | 0
something     | 0
something     | 2
</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/posts/first/">
        A new Blog this time on github and statically generated
      </a>
    </h1>

    <span class="post-date">Mon, Feb 9, 2015</span>

    <p>It has been a long time since I last did a blog the biggest reason behind were:</p>

<ul>
<li>it&rsquo;s hard to maintain a server and a blog platform</li>
<li>most common web plateforms are blocked in China</li>
<li>the other plateforms does not fit my geeky needs</li>
<li>non-self hosted platform make it hard to have easy backup of your data</li>
</ul>

<p>So here we are, after reading comments on HackerNews I&rsquo;ve found the project
<a href="http://gohugo.io">Hugo</a> which permits you to create a static blog the
advantages I see to it</p>

<ul>
<li>it&rsquo;s all command line and simple to install</li>
<li>vim and markdown friendly, posting is just one more markdown file</li>
<li>can be hosted on github (which solve the hosting problem)</li>
<li>it&rsquo;s text files and git (which solve the backup problem)</li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://allan-simon.github.io/blog/about/">
        about
      </a>
    </h1>

    <span class="post-date">Mon, Feb 9, 2015</span>

    

<h2 id="toc_0">What will you find on this blog</h2>

<ul>
<li>My daily discoveries and tips, mostly web/linux/devops/c++/c/rust related.</li>
<li>Some tips and tricks on how to survive in the Chinese internet as a devops</li>
<li>Some news concerning my personnal projects</li>
<li>Random thoughts as I progress in my professional and personnal career.</li>
</ul>

  </div>
  
</div>
</div>

  </body>
</html>
